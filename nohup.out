INFO:     Will watch for changes in these directories: ['/Users/jameswilson/Desktop/PRODUCTION/test/casMay4']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [11522] using WatchFiles
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
🔧 Starting CasaLingua in development mode
🚧 Dev mode active: DEBUG logging enabled, hot reload expected.
2025-05-08 16:17:45 - session_manager - ✓ INFO - Session manager initialized with 3600s TTL, 300s cleanup interval
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-05-08 16:17:45 - server - ✓ INFO - Started server process [11524]
2025-05-08 16:17:45 - on - ✓ INFO - Waiting for application startup.

╔════════════════════════════════════════════════════════════════════════════╗
║                                                                            ║
║      _____                _      _                                                             ║
║     / ____|              | |    (_)                                                            ║
║    | |     __ _ ___  __ _| |     _ _ __   __ _ _   _  __ _                                     ║
║    | |    / _` / __|/ _` | |    | | '_ \ / _` | | | |/ _` |                                    ║
║    | |___| (_| \__ \ (_| | |____| | | | | (_| | |_| | (_| |                                    ║
║     \_____\__,_|___/\__,_|______|_|_| |_|\__, |\__,_|\__,_|                                    ║
║                                           |___/                                                ║
║                                                                            ║
║   Language Processing & Translation Pipeline                               ║
║   Version: 1.0.0                                                           ║
║                                                                            ║
╚════════════════════════════════════════════════════════════════════════════╝

2025-05-08 16:17:45 - config - 🔍 DEBUG - Loaded default config (values omitted)
2025-05-08 16:17:45 - config - 🔍 DEBUG - Loaded environment-specific config (values omitted)
2025-05-08 16:17:45 - config - 🔍 DEBUG - Loaded environment variables config (values omitted)
2025-05-08 16:17:45 - config - ⚠️ WARNING - Missing required config keys: server_host, server_port, log_level, models_dir, log_dir, using defaults
2025-05-08 16:17:45 - config - 🔍 DEBUG - Validated config merged from: default: config/default.json, development: config/development.json, environment variables
2025-05-08 16:17:45 - config - ✓ INFO - Configuration changed for environment 'development', notifying 0 callbacks
2025-05-08 16:17:45 - main - ✓ INFO - Environment: development
2025-05-08 16:17:45 - main - ✓ INFO - Python version: 3.10.13
2025-05-08 16:17:45 - main - ✓ INFO - Server time: 2025-05-08 16:17:45
2025-05-08 16:17:45 - logging - ✓ INFO - Logging configured - Level: INFO, Environment: development
──────────────────────────────────────────────────────────────────────── 🚀 PHASE 1: Detecting Hardware ────────────────────────────────────────────────────────────────────────
2025-05-08 16:17:45 - main - ✓ INFO - PHASE 1/5: Detecting hardware capabilities...
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Starting simplified hardware detection...
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected M4 Pro/Max with 48GB RAM configuration
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected Apple Silicon: M4 M4 Pro/Max
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected system: Darwin Darwin Kernel Version 24.5.0: Tue Apr 22 19:53:27 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6041
2025-05-08 16:17:45 - simple_detector - ✓ INFO - System detection complete
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected 48GB memory configuration (M4 Pro/Max)
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Enhanced memory detection: 20.15 GB available
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected Memory: 48.0 GB total, 20.15 GB available
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Memory Model: high_capacity
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Memory detection complete
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected Apple M4 Max with 16 logical cores
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected CPU: Apple M4 Max with 16 logical cores
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Apple Silicon variant: M4 Max
2025-05-08 16:17:45 - simple_detector - ✓ INFO - CPU detection complete
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Detected Apple M4 Pro Integrated GPU with MPS support
2025-05-08 16:17:45 - simple_detector - ✓ INFO - GPU has 28 compute units
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Neural Engine: 16 cores
2025-05-08 16:17:45 - simple_detector - ✓ INFO - GPU detection complete
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Hardware Summary: Darwin Darwin Kernel Version 24.5.0: Tue Apr 22 19:53:27 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6041, Apple M4 Max (16 cores), 48.0GB RAM, GPU: Available
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended device: mps
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:17:45 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:17:45 - main - ✓ INFO - 🧠 Auto-upgraded model_size to 'medium' based on hardware detection
2025-05-08 16:17:45 - main - ✓ INFO - ✓ Hardware detection complete
────────────────────────────────────────────────────────────────────────── 🔧 PHASE 2: Loading Models ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:17:45 - main - ✓ INFO - PHASE 2/5: Initializing model loader...
2025-05-08 16:17:45 - loader - ✓ INFO - Loaded model registry from config/model_registry.json
2025-05-08 16:17:45 - loader - ✓ INFO - Loaded model registry from config/model_registry.json
2025-05-08 16:17:45 - loader - ✓ INFO - Updated model registry with 11 entries
                                       Model Registry                                       
┏━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Model Type         ┃ Model                                       ┃ Framework             ┃
┡━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩
│ language_detection │ papluca/xlm-roberta-base-language-detection │ transformers          │
│ translation        │ facebook/nllb-200-1.3B                      │ transformers          │
│ mbart_translation  │ facebook/mbart-large-50-many-to-many-mmt    │ transformers          │
│ mt5_translation    │ google/mt5-small                            │ transformers          │
│ ner_detection      │ dslim/bert-base-NER                         │ transformers          │
│ simplifier         │ facebook/bart-large-cnn                     │ transformers          │
│ tts                │ espnet/kan-bayashi_ljspeech_vits            │ transformers          │
│ rag_generator      │ google/mt5-base                             │ transformers          │
│ anonymizer         │ bert-base-cased                             │ transformers          │
│ rag_retriever      │ sentence-transformers/all-mpnet-base-v2     │ sentence-transformers │
│ embedding_model    │ sentence-transformers/all-mpnet-base-v2     │ sentence-transformers │
└────────────────────┴─────────────────────────────────────────────┴───────────────────────┘
2025-05-08 16:17:45 - loader - ✓ INFO - Discovered MPS device (Apple Silicon)
2025-05-08 16:17:45 - loader - ✓ INFO - ModelLoader initialized with available devices: mps, cpu
ModelLoader initialized - Available devices: mps, cpu
Default device: mps
2025-05-08 16:17:45 - main - ✓ INFO - Checking for required models and downloading if necessary...
2025-05-08 16:17:45 - main - ✓ INFO - Model translation_model already exists, skipping download
2025-05-08 16:17:45 - main - ✓ INFO - Model translation_small already exists, skipping download
2025-05-08 16:17:45 - main - ✓ INFO - Model language_detection already exists, skipping download
2025-05-08 16:17:45 - main - ✓ INFO - Initializing enhanced model manager...
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Enhanced Model Manager Initialized                                                                                                                                           │
│ Device: mps, Precision: float16                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:17:45 - main - ✓ INFO - PHASE 2b: Bootstrapping all models before exposing API...

Bootstrapping Essential Models
Loading Tier 1 (Critical) Models...
2025-05-08 16:17:45 - loader - ✓ INFO - Loading critical model: language_detection...
Loading language_detection...
Loading model: language_detection
2025-05-08 16:17:45 - loader - ✓ INFO - Loading language_detection (papluca/xlm-roberta-base-language-detection)
Loading language_detection (papluca/xlm-roberta-base-language-detection)
2025-05-08 16:17:45 - loader - ✓ INFO - Loading tokenizer for language_detection...
Loading tokenizer for language_detection...
2025-05-08 16:17:45 - loader - ✓ INFO - Loading tokenizer: papluca/xlm-roberta-base-language-detection
2025-05-08 16:17:45 - loader - ✓ INFO - Loading model for language_detection...
Loading model for language_detection...
2025-05-08 16:17:45 - loader - ✓ INFO - Loading Transformers model: papluca/xlm-roberta-base-language-detection on mps
2025-05-08 16:17:47 - loader - ✓ INFO - Successfully loaded papluca/xlm-roberta-base-language-detection on mps
2025-05-08 16:17:47 - loader - ✓ INFO - Finalizing language_detection model...
Finalizing language_detection model...
2025-05-08 16:17:47 - loader - ✓ INFO - Model language_detection loaded successfully!
Model language_detection loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: language_detection                                                                                                                              │
│ Loaded in 2.39s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:17:48 - loader - ✓ INFO - Bootstrapped critical model language_detection in 2.60s
✓ Loaded language_detection in 2.60s
2025-05-08 16:17:48 - loader - ✓ INFO - Loading critical model: translation...
Loading translation...
Loading model: translation
2025-05-08 16:17:48 - loader - ✓ INFO - Loading translation (facebook/nllb-200-1.3B)
Loading translation (facebook/nllb-200-1.3B)
2025-05-08 16:17:48 - loader - ✓ INFO - Loading tokenizer for translation...
Loading tokenizer for translation...
2025-05-08 16:17:48 - loader - ✓ INFO - Loading tokenizer: facebook/nllb-200-1.3B
2025-05-08 16:17:48 - loader - ✓ INFO - Loading model for translation...
Loading model for translation...
2025-05-08 16:17:48 - loader - ⚠️ WARNING - ⚠️ Forcing CPU device for facebook/nllb-200-1.3B due to MPS compatibility issues
2025-05-08 16:17:48 - loader - ✓ INFO - Loading Transformers model: facebook/nllb-200-1.3B on cpu
2025-05-08 16:17:59 - loader - ✓ INFO - Successfully loaded facebook/nllb-200-1.3B on cpu
2025-05-08 16:17:59 - loader - ✓ INFO - Finalizing translation model...
Finalizing translation model...
2025-05-08 16:17:59 - loader - ✓ INFO - Model translation loaded successfully!
Model translation loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: translation                                                                                                                                     │
│ Loaded in 11.50s                                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:17:59 - loader - ✓ INFO - Bootstrapped critical model translation in 11.71s
✓ Loaded translation in 11.71s
Loading Tier 2 (Important) Models...
2025-05-08 16:17:59 - loader - ✓ INFO - Loading important model: ner_detection...
Loading ner_detection...
Loading model: ner_detection
2025-05-08 16:17:59 - loader - ✓ INFO - Loading ner_detection (dslim/bert-base-NER)
Loading ner_detection (dslim/bert-base-NER)
2025-05-08 16:17:59 - loader - ✓ INFO - Loading tokenizer for ner_detection...
Loading tokenizer for ner_detection...
2025-05-08 16:17:59 - loader - ✓ INFO - Loading tokenizer: dslim/bert-base-NER
2025-05-08 16:17:59 - loader - ✓ INFO - Loading model for ner_detection...
Loading model for ner_detection...
2025-05-08 16:17:59 - loader - ✓ INFO - Loading Transformers model: dslim/bert-base-NER on mps
2025-05-08 16:18:00 - loader - ✓ INFO - Successfully loaded dslim/bert-base-NER on mps
2025-05-08 16:18:00 - loader - ✓ INFO - Finalizing ner_detection model...
Finalizing ner_detection model...
2025-05-08 16:18:00 - loader - ✓ INFO - Model ner_detection loaded successfully!
Model ner_detection loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: ner_detection                                                                                                                                   │
│ Loaded in 0.75s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:00 - loader - ✓ INFO - Bootstrapped important model ner_detection in 0.95s
✓ Loaded ner_detection in 0.95s
2025-05-08 16:18:00 - loader - ✓ INFO - Loading important model: simplifier...
Loading simplifier...
Loading model: simplifier
2025-05-08 16:18:00 - loader - ✓ INFO - Loading simplifier (facebook/bart-large-cnn)
Loading simplifier (facebook/bart-large-cnn)
2025-05-08 16:18:00 - loader - ✓ INFO - Loading tokenizer for simplifier...
Loading tokenizer for simplifier...
2025-05-08 16:18:00 - loader - ✓ INFO - Loading tokenizer: facebook/bart-large-cnn
2025-05-08 16:18:00 - loader - ✓ INFO - Loading model for simplifier...
Loading model for simplifier...
2025-05-08 16:18:00 - loader - ✓ INFO - Loading Transformers model: facebook/bart-large-cnn on mps
2025-05-08 16:18:03 - loader - ✓ INFO - Successfully loaded facebook/bart-large-cnn on mps
2025-05-08 16:18:03 - loader - ✓ INFO - Finalizing simplifier model...
Finalizing simplifier model...
2025-05-08 16:18:03 - loader - ✓ INFO - Model simplifier loaded successfully!
Model simplifier loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: simplifier                                                                                                                                      │
│ Loaded in 3.24s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:04 - loader - ✓ INFO - Bootstrapped important model simplifier in 3.44s
✓ Loaded simplifier in 3.44s
Registering Tier 3 (On-demand) Models for lazy loading...
2025-05-08 16:18:04 - loader - ✓ INFO - Registered 3 models for lazy loading: rag_generator, rag_retriever, anonymizer
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Progressive model bootstrap successful                                                                                                                                     │
│ Loaded 4 models immediately                                                                                                                                                  │
│ Registered 3 models for lazy loading                                                                                                                                         │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:04 - main - ✓ INFO - ✓ Model system initialized
2025-05-08 16:18:04 - main - ✓ INFO - Initializing shared tokenizer pipeline...
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/transformers/convert_slow_tokenizer.py:446: UserWarning: The sentencepiece tokenizer that you are converting to a fast tokenizer uses the byte fallback option which is not implemented in the fast tokenizers. In practice this means that the fast version of the tokenizer can produce unknown tokens whereas the sentencepiece version would have converted these unknown tokens into a sequence of byte tokens matching the original piece of text.
  warnings.warn(
2025-05-08 16:18:06 - tokenizer - ✓ INFO - ✓ Loaded tokenizer: google/mt5-small
───────────────────────────────────────────────────────────────────────── 🧾 PHASE 3: Audit & Metrics ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:18:06 - main - ✓ INFO - PHASE 3/5: Starting audit system...
2025-05-08 16:18:06 - logger - ✓ INFO - Audit logger initialized
2025-05-08 16:18:06 - metrics - ✓ INFO - Metrics collector initialized
2025-05-08 16:18:06 - logger - ✓ INFO - Initializing audit logger...
2025-05-08 16:18:06 - logger - ✓ INFO - Audit logger initialization complete
2025-05-08 16:18:06 - main - ✓ INFO - ✓ Audit system initialized
────────────────────────────────────────────────────────────────────────── 🗄️ PHASE 3.5: Database Init ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:18:06 - main - ✓ INFO - PHASE 3.5/5: Initializing database persistence...
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Created health check table in ./data/users.db
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Created health check table in ./data/content.db
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Created health check table in ./data/progress.db
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Initialized and validated persistence manager
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Verifying database connections...
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Verified users database connection: 451 health check records
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Verified content database connection: 451 health check records
2025-05-08 16:18:06 - persistence_init - ✓ INFO - Verified progress database connection: 451 health check records
2025-05-08 16:18:06 - main - ✓ INFO - ✓ Database persistence initialized
────────────────────────────────────────────────────────────────────────── 🧠 PHASE 4: Pipeline Init ───────────────────────────────────────────────────────────────────────────
2025-05-08 16:18:06 - main - ✓ INFO - PHASE 4/5: Setting up processing pipeline...
2025-05-08 16:18:06 - main - ✓ INFO - Eagerly loading essential models...
2025-05-08 16:18:06 - main - ✓ INFO - Preloading language_detection model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading translation model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading mbart_translation model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading simplifier model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading ner_detection model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading embedding_model model
2025-05-08 16:18:06 - main - ✓ INFO - Preloading anonymizer model
Enhanced loading of model: language_detection
2025-05-08 16:18:06 - manager - ✓ INFO - Loading language_detection model with float16 precision...
Loading language_detection model with float16 precision...
Loading model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:18:06 - manager - ✓ INFO - Model language_detection loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: language_detection in 0.00s                                                                                                                     │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:06 - main - ✓ INFO - ✓ language_detection model loaded successfully
Enhanced loading of model: translation
2025-05-08 16:18:06 - manager - ✓ INFO - Loading translation model with float16 precision...
Loading translation model with float16 precision...
Loading model: translation
✓ Model translation already loaded from cache
2025-05-08 16:18:06 - manager - ✓ INFO - Model translation loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: translation in 0.00s                                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:06 - main - ✓ INFO - ✓ translation model loaded successfully
Enhanced loading of model: mbart_translation
2025-05-08 16:18:06 - manager - ✓ INFO - Loading mbart_translation model with float16 precision...
Loading mbart_translation model with float16 precision...
Loading model: mbart_translation
2025-05-08 16:18:06 - loader - ✓ INFO - Loading mbart_translation (facebook/mbart-large-50-many-to-many-mmt)
Loading mbart_translation (facebook/mbart-large-50-many-to-many-mmt)
2025-05-08 16:18:06 - loader - ✓ INFO - Loading tokenizer for mbart_translation...
Loading tokenizer for mbart_translation...
2025-05-08 16:18:06 - loader - ✓ INFO - Loading tokenizer: facebook/mbart-large-50-many-to-many-mmt
2025-05-08 16:18:06 - loader - ✓ INFO - Loading specialized MBART tokenizer for facebook/mbart-large-50-many-to-many-mmt
2025-05-08 16:18:07 - loader - ✓ INFO - Successfully loaded MBART tokenizer using AutoTokenizer
2025-05-08 16:18:07 - loader - ✓ INFO - Loading model for mbart_translation...
Loading model for mbart_translation...
2025-05-08 16:18:07 - loader - ⚠️ WARNING - ⚠️ Forcing CPU device for facebook/mbart-large-50-many-to-many-mmt due to MPS compatibility issues
2025-05-08 16:18:07 - loader - ✓ INFO - Loading Transformers model: facebook/mbart-large-50-many-to-many-mmt on cpu
2025-05-08 16:18:12 - loader - ✓ INFO - Successfully loaded facebook/mbart-large-50-many-to-many-mmt on cpu
2025-05-08 16:18:12 - loader - ✓ INFO - Finalizing mbart_translation model...
Finalizing mbart_translation model...
2025-05-08 16:18:12 - loader - ✓ INFO - Model mbart_translation loaded successfully!
Model mbart_translation loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: mbart_translation                                                                                                                               │
│ Loaded in 6.23s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:12 - manager - ✓ INFO - Model mbart_translation loaded successfully in 6.44s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: mbart_translation in 6.44s                                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:12 - main - ✓ INFO - ✓ mbart_translation model loaded successfully
Enhanced loading of model: simplifier
2025-05-08 16:18:12 - manager - ✓ INFO - Loading simplifier model with float16 precision...
Loading simplifier model with float16 precision...
Loading model: simplifier
✓ Model simplifier already loaded from cache
2025-05-08 16:18:12 - manager - ✓ INFO - Model simplifier loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: simplifier in 0.00s                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:12 - main - ✓ INFO - ✓ simplifier model loaded successfully
Enhanced loading of model: ner_detection
2025-05-08 16:18:12 - manager - ✓ INFO - Loading ner_detection model with float16 precision...
Loading ner_detection model with float16 precision...
Loading model: ner_detection
✓ Model ner_detection already loaded from cache
2025-05-08 16:18:12 - manager - ✓ INFO - Model ner_detection loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: ner_detection in 0.00s                                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:12 - main - ✓ INFO - ✓ ner_detection model loaded successfully
Enhanced loading of model: embedding_model
2025-05-08 16:18:12 - manager - ✓ INFO - Loading embedding_model model with float16 precision...
Loading embedding_model model with float16 precision...
Loading model: embedding_model
2025-05-08 16:18:12 - loader - ✓ INFO - Loading embedding_model (sentence-transformers/all-mpnet-base-v2)
Loading embedding_model (sentence-transformers/all-mpnet-base-v2)
2025-05-08 16:18:12 - loader - ✓ INFO - Loading embedding model for embedding_model...
Loading embedding model for embedding_model...
2025-05-08 16:18:12 - loader - ✓ INFO - Loading SentenceTransformer model: sentence-transformers/all-mpnet-base-v2
2025-05-08 16:18:12 - SentenceTransformer - ✓ INFO - Load pretrained SentenceTransformer: sentence-transformers/all-mpnet-base-v2
2025-05-08 16:18:12 - loader - ✓ INFO - Finalizing embedding_model model...
Finalizing embedding_model model...
2025-05-08 16:18:12 - loader - ✓ INFO - Model embedding_model loaded successfully!
Model embedding_model loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: embedding_model                                                                                                                                 │
│ Loaded in 0.47s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:13 - manager - ✓ INFO - Model embedding_model loaded successfully in 0.68s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: embedding_model in 0.68s                                                                                                                        │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:13 - main - ✓ INFO - ✓ embedding_model model loaded successfully
Enhanced loading of model: anonymizer
2025-05-08 16:18:13 - manager - ✓ INFO - Loading anonymizer model with float16 precision...
Loading anonymizer model with float16 precision...
2025-05-08 16:18:13 - loader - ✓ INFO - Recorded first request for lazy-load model: anonymizer
Loading model: anonymizer
2025-05-08 16:18:13 - loader - ✓ INFO - Loading anonymizer (bert-base-cased)
Loading anonymizer (bert-base-cased)
2025-05-08 16:18:13 - loader - ✓ INFO - Loading tokenizer for anonymizer...
Loading tokenizer for anonymizer...
2025-05-08 16:18:13 - loader - ✓ INFO - Loading tokenizer: bert-base-cased
2025-05-08 16:18:13 - loader - ✓ INFO - Loading model for anonymizer...
Loading model for anonymizer...
2025-05-08 16:18:13 - loader - ✓ INFO - Loading Transformers model: bert-base-cased on mps
2025-05-08 16:18:13 - loader - ✓ INFO - Successfully loaded bert-base-cased on mps
2025-05-08 16:18:13 - loader - ✓ INFO - Finalizing anonymizer model...
Finalizing anonymizer model...
2025-05-08 16:18:13 - loader - ✓ INFO - Model anonymizer loaded successfully!
Model anonymizer loaded successfully!
2025-05-08 16:18:13 - loader - ✓ INFO - Lazy-loaded model anonymizer after 1 requests
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: anonymizer                                                                                                                                      │
│ Loaded in 0.77s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:14 - manager - ✓ INFO - Model anonymizer loaded successfully in 0.98s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: anonymizer in 0.98s                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:14 - main - ✓ INFO - ✓ anonymizer model loaded successfully
2025-05-08 16:18:14 - main - ✓ INFO - Essential model preloading complete
2025-05-08 16:18:14 - logger - ✓ INFO - Audit logger initialized
2025-05-08 16:18:14 - metrics - ✓ INFO - Metrics collector initialized
2025-05-08 16:18:14 - veracity - ✓ INFO - Veracity auditor initialized
2025-05-08 16:18:14 - processor - ✓ INFO - UnifiedProcessor initialized (components not yet loaded)
2025-05-08 16:18:14 - processor - ✓ INFO - Initializing UnifiedProcessor components
2025-05-08 16:18:14 - processor - ✓ INFO - Initializing translation pipeline
2025-05-08 16:18:14 - translator - ✓ INFO - Translation pipeline created (not yet initialized)
2025-05-08 16:18:14 - translator - ✓ INFO - Initializing translation pipeline
2025-05-08 16:18:14 - translator - ✓ INFO - Loading language detection model
Enhanced loading of model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:18:14 - translator - ✓ INFO - Language detection model ready
2025-05-08 16:18:14 - translator - ✓ INFO - Translation pipeline initialization complete
2025-05-08 16:18:14 - processor - ✓ INFO - Translation pipeline initialization complete
2025-05-08 16:18:14 - processor - ✓ INFO - Initializing language detector
2025-05-08 16:18:14 - language_detector - ✓ INFO - Language detector initialized (not yet loaded)
2025-05-08 16:18:14 - language_detector - ✓ INFO - Initializing language detector
Enhanced loading of model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:18:14 - language_detector - ✓ INFO - Language detection model loaded: unknown
2025-05-08 16:18:14 - language_detector - ✓ INFO - LangDetect library available for fallback
2025-05-08 16:18:14 - language_detector - ✓ INFO - NLTK available for fallback
2025-05-08 16:18:14 - language_detector - ✓ INFO - Language detector initialization complete
2025-05-08 16:18:14 - processor - ✓ INFO - Language detector initialization complete
2025-05-08 16:18:14 - processor - ✓ INFO - Initializing STT pipeline
2025-05-08 16:18:14 - stt - ✓ INFO - STT pipeline created (not yet initialized)
2025-05-08 16:18:14 - stt - ✓ INFO - Initializing STT pipeline
Enhanced loading of model: speech_to_text
2025-05-08 16:18:14 - manager - ✓ INFO - Loading speech_to_text model with float16 precision...
Loading speech_to_text model with float16 precision...
2025-05-08 16:18:14 - Loading model: speech_to_text
processor - ✓ INFO - Initializing TTS pipeline
2025-05-08 16:18:14 - loader - ⚠️ WARNING - No model configuration found for 'speech_to_text', using generic fallback
2025-05-08 16:18:14 - tts - ✓ INFO - TTS pipeline created (not yet initialized)
2025-05-08 16:18:14 - loader - ✓ INFO - Loading speech_to_text (google/mt5-small)
Loading speech_to_text (google/mt5-small)
2025-05-08 16:18:14 - tts - ✓ INFO - Initializing TTS pipeline
Enhanced loading of model: tts
2025-05-08 16:18:14 - loader - ✓ INFO - Loading tokenizer for speech_to_text...
Loading tokenizer for speech_to_text...
2025-05-08 16:18:14 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
2025-05-08 16:18:14 - Loading model: tts
loader - ✓ INFO - Loading tokenizer: google/mt5-small
2025-05-08 16:18:14 - processor - ✓ INFO - Initializing simplifier
2025-05-08 16:18:14 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
2025-05-08 16:18:14 - loaderError loading tts: Unsupported model type: pipeline
 - ✓ INFO - Loading specialized MT5 tokenizer for google/mt5-small
2025-05-08 16:18:14 - simplifier - ✓ INFO - Simplification pipeline created (not yet initialized)
2025-05-08 16:18:14 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:18:14 - simplifier - ✓ INFO - Initializing simplification pipeline
2025-05-08 16:18:14 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
2025-05-08 16:18:14 - simplifier - ✓ INFO - Loading simplification model (simplifier)
Enhanced loading of model: simplifier
✓ Model simplifier already loaded from cache
2025-05-08 16:18:14 - simplifier - ✓ INFO - Simplification model loaded successfully
2025-05-08 16:18:14 - simplifier - ✓ INFO - Loaded grade level vocabulary for 2 grade levels
2025-05-08 16:18:14 - simplifier - ✓ INFO - Simplification pipeline initialization complete
2025-05-08 16:18:14 - processor - ✓ INFO - Simplifier initialization complete
Retry #2 loading model: tts
2025-05-08 16:18:15 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:18:15 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:18:15 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
2025-05-08 16:18:15 - loader - ✓ INFO - Successfully loaded MT5 tokenizer using AutoTokenizer
2025-05-08 16:18:15 - loader - ✓ INFO - Loading model for speech_to_text...
Loading model for speech_to_text...
2025-05-08 16:18:15 - loader - ✓ INFO - Loading Transformers model: google/mt5-small on mps
Retry #3 loading model: tts
2025-05-08 16:18:17 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:18:17 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:17 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:18:17 - tts - ⚠️ WARNING - Error loading TTS model: Unsupported model type: pipeline
2025-05-08 16:18:17 - tts - ⚠️ WARNING - TTS functionality will be limited to fallbacks
2025-05-08 16:18:17 - tts - ✓ INFO - TTS pipeline initialization complete
2025-05-08 16:18:17 - processor - ✓ INFO - TTS pipeline initialization complete
2025-05-08 16:18:18 - loader - ✓ INFO - Successfully loaded google/mt5-small on mps
2025-05-08 16:18:18 - loader - ✓ INFO - Finalizing speech_to_text model...
Finalizing speech_to_text model...
2025-05-08 16:18:18 - loader - ✓ INFO - Model speech_to_text loaded successfully!
Model speech_to_text loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: speech_to_text                                                                                                                                  │
│ Loaded in 4.02s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:18 - manager - ✓ INFO - Model speech_to_text loaded successfully in 4.23s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: speech_to_text in 4.23s                                                                                                                         │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:18 - stt - ✓ INFO - STT model loaded successfully
2025-05-08 16:18:18 - stt - ✓ INFO - STT pipeline initialization complete
2025-05-08 16:18:18 - processor - ✓ INFO - STT pipeline initialization complete
2025-05-08 16:18:18 - processor - ✓ INFO - UnifiedProcessor initialization complete
2025-05-08 16:18:18 - main - ✓ INFO - ✓ Processing pipeline ready
──────────────────────────────────────────────────────────────────────────── 🌐 PHASE 5: API Ready ─────────────────────────────────────────────────────────────────────────────
2025-05-08 16:18:18 - main - ✓ INFO - PHASE 5/5: Initializing API endpoints...
2025-05-08 16:18:18 - main - ✓ INFO - Initializing route cache...
2025-05-08 16:18:18 - route_cache - ✓ INFO - Route cache 'default' initialized with max_size=1000, ttl_seconds=3600, bloom_compatible=True
2025-05-08 16:18:18 - route_cache - ✓ INFO - Route cache 'translation' initialized with max_size=2000, ttl_seconds=7200, bloom_compatible=True
2025-05-08 16:18:18 - main - ✓ INFO - ✓ Route cache initialized with 1000 entries default capacity
2025-05-08 16:18:18 - main - ✓ INFO - Initializing session manager cleanup task...
2025-05-08 16:18:18 - session_manager - ✓ INFO - Starting session cleanup task
2025-05-08 16:18:18 - main - ✓ INFO - ✓ Session manager cleanup task started
                   🔍 Hardware Summary                   
┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Component     ┃ Details                               ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ CPU           │ Apple M4_Max - 16 cores / 16 threads  │
│ Memory        │ 48.0 GB total / 20.1 GB available     │
│ GPU           │ Apple M4 Pro Integrated GPU (48.0 GB) │
│ Apple Silicon │ M4 Max with 48GB                      │
└───────────────┴───────────────────────────────────────┘
╭────────────────────────────────────────╮
│ 🎉 CasaLingua Boot Complete            │
│ System is ready and accepting requests │
╰────────────────────────────────────────╯
2025-05-08 16:18:18 - main - ✓ INFO - ✓ CasaLingua system initialization complete
2025-05-08 16:18:18 - main - ✓ INFO - ✓ Server is ready to accept connections!
2025-05-08 16:18:18 - session_manager - ✓ INFO - Starting session cleanup task with interval 300s
2025-05-08 16:18:18 - on - ✓ INFO - Application startup complete.
2025-05-08 16:18:32 - direct_tts - ✓ INFO - Direct TTS request: text='This is a test of the direct TTS endpoint using gT...', language=en
2025-05-08 16:18:33 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_2edd643e-d76a-4777-b9b7-39e8876a1f04.mp3 (44544 bytes) in 0.22s
2025-05-08 16:18:33 - httptools_impl - ✓ INFO - 127.0.0.1:55022 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:18:45 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:18:45 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:18:45 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:18:45 - manager - ✓ INFO - Model tts not loaded, loading now
Enhanced loading of model: tts
2025-05-08 16:18:45 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
Loading model: tts
2025-05-08 16:18:45 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:18:45 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:18:45 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
Retry #2 loading model: tts
2025-05-08 16:18:46 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:18:46 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:18:46 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
Retry #3 loading model: tts
2025-05-08 16:18:48 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:18:48 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:48 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:18:48 - tts - ❌ ERROR - Error using TTS model: Unsupported model type: pipeline
2025-05-08 16:18:48 - tts - ✓ INFO - Creating emergency audio content with gTTS
2025-05-08 16:18:48 - tts - ✓ INFO - Created emergency audio with gTTS: 49728 bytes
2025-05-08 16:18:52 - tts - ❌ ERROR - Error synthesizing speech: local variable 'result' referenced before assignment
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/tts.py", line 283, in synthesize
    metadata = result.get("metadata", {})
UnboundLocalError: local variable 'result' referenced before assignment
2025-05-08 16:18:52 - tts - ✓ INFO - Using fallback TTS implementation
2025-05-08 16:18:52 - manager - ✓ INFO - Model tts_fallback not loaded, loading now
Enhanced loading of model: tts_fallback
2025-05-08 16:18:52 - manager - ✓ INFO - Loading tts_fallback model with float16 precision...
Loading tts_fallback model with float16 precision...
Loading model: tts_fallback
2025-05-08 16:18:52 - loader - ⚠️ WARNING - No model configuration found for 'tts_fallback', using generic fallback
2025-05-08 16:18:52 - loader - ✓ INFO - Loading tts_fallback (google/mt5-small)
Loading tts_fallback (google/mt5-small)
2025-05-08 16:18:52 - loader - ✓ INFO - Loading tokenizer for tts_fallback...
Loading tokenizer for tts_fallback...
2025-05-08 16:18:52 - loader - ✓ INFO - Loading tokenizer: google/mt5-small
2025-05-08 16:18:52 - loader - ✓ INFO - Loading specialized MT5 tokenizer for google/mt5-small
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/transformers/convert_slow_tokenizer.py:446: UserWarning: The sentencepiece tokenizer that you are converting to a fast tokenizer uses the byte fallback option which is not implemented in the fast tokenizers. In practice this means that the fast version of the tokenizer can produce unknown tokens whereas the sentencepiece version would have converted these unknown tokens into a sequence of byte tokens matching the original piece of text.
  warnings.warn(
2025-05-08 16:18:54 - loader - ✓ INFO - Successfully loaded MT5 tokenizer using AutoTokenizer
2025-05-08 16:18:54 - loader - ✓ INFO - Loading model for tts_fallback...
Loading model for tts_fallback...
2025-05-08 16:18:54 - loader - ✓ INFO - Loading Transformers model: google/mt5-small on mps
2025-05-08 16:18:55 - loader - ✓ INFO - Successfully loaded google/mt5-small on mps
2025-05-08 16:18:55 - loader - ✓ INFO - Finalizing tts_fallback model...
Finalizing tts_fallback model...
2025-05-08 16:18:55 - loader - ✓ INFO - Model tts_fallback loaded successfully!
Model tts_fallback loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: tts_fallback                                                                                                                                    │
│ Loaded in 3.31s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:56 - manager - ✓ INFO - Model tts_fallback loaded successfully in 3.51s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: tts_fallback in 3.51s                                                                                                                           │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:18:56 - veracity - ✓ INFO - Veracity auditor initialized
2025-05-08 16:18:56 - wrapper - ✓ INFO - Initialized veracity auditor for tts_fallback
2025-05-08 16:18:56 - wrapper - ✓ INFO - Using TranslationModelWrapper for MT5 model: google/mt5-small
2025-05-08 16:18:56 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:18:56 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate from English to fluent Spanish Pay atten...
2025-05-08 16:18:56 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:18:56 - wrapper - ✓ INFO - Applied enhanced generation parameters for en->es
2025-05-08 16:18:58 - veracity - ✓ INFO - [Basic Validation] Length ratio outside expected range for en->None
2025-05-08 16:18:58 - veracity - ✓ INFO - [Content Integrity] Entity preservation low: 0.00
2025-05-08 16:18:58 - wrapper - ✓ INFO - Using pre-computed veracity data with score: 0.5
2025-05-08 16:18:58 - wrapper - ✓ INFO - Successfully decoded 1 translation(s)
2025-05-08 16:18:58 - httptools_impl - ✓ INFO - 127.0.0.1:55034 - "POST /pipeline/tts HTTP/1.1" 200
2025-05-08 16:18:58 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:18:58 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:18:58 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:18:58 - httptools_impl - ✓ INFO - 127.0.0.1:55042 - "GET /pipeline/tts/audio/tts_25c76667-457d-45e9-a528-bb71ec4bb5a8.mp3 HTTP/1.1" 200
2025-05-08 16:19:32 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:19:32 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:19:32 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:19:32 - veracity - ✓ INFO - Veracity auditor initialized
2025-05-08 16:19:32 - wrapper - ✓ INFO - Initialized veracity auditor for speech_to_text
2025-05-08 16:19:32 - wrapper - ✓ INFO - Using TranslationModelWrapper for MT5 model: google/mt5-small
2025-05-08 16:19:32 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:19:32 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:19:32 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:19:32 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:19:32 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:19:32 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:19:32 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:19:32 - httptools_impl - ✓ INFO - 127.0.0.1:55097 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:19:43 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:19:43 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:19:43 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:19:43 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:19:43 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:19:43 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:19:43 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:19:43 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:19:44 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:19:44 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:19:44 - httptools_impl - ✓ INFO - 127.0.0.1:55123 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:19:49 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:19:49 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:19:49 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:19:49 - stt - ❌ ERROR - Error getting supported languages: Unknown method get_languages
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 309, in get_supported_languages
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method get_languages
2025-05-08 16:19:49 - httptools_impl - ✓ INFO - 127.0.0.1:55138 - "GET /pipeline/stt/languages HTTP/1.1" 200
2025-05-08 16:19:56 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:19:56 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:19:56 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:19:56 - manager - ✓ INFO - Model tts not loaded, loading now
Enhanced loading of model: tts
2025-05-08 16:19:56 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
Loading model: tts
2025-05-08 16:19:56 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:19:56 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:19:56 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
Retry #2 loading model: tts
2025-05-08 16:19:57 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:19:57 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:19:57 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
Retry #3 loading model: tts
2025-05-08 16:19:59 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:19:59 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:19:59 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:19:59 - tts - ❌ ERROR - Error getting available voices: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/tts.py", line 352, in get_available_voices
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 530, in run_model
    model_info = await self.load_model(model_type)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 163, in load_model
    model_info = await self.loader.load_model_async(model_type_str, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 780, in load_model_async
    return await loop.run_in_executor(
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 782, in <lambda>
    lambda: self.load_model(model_type, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:19:59 - httptools_impl - ✓ INFO - 127.0.0.1:55149 - "GET /pipeline/tts/voices HTTP/1.1" 200
2025-05-08 16:20:08 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:20:08 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:20:08 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:20:08 - stt - ❌ ERROR - Error getting supported languages: Unknown method get_languages
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 309, in get_supported_languages
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method get_languages
2025-05-08 16:20:08 - httptools_impl - ✓ INFO - 127.0.0.1:55172 - "GET /pipeline/stt/languages HTTP/1.1" 200
2025-05-08 16:20:08 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:20:08 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:20:08 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:20:08 - manager - ✓ INFO - Model tts not loaded, loading now
Enhanced loading of model: tts
2025-05-08 16:20:08 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
Loading model: tts
2025-05-08 16:20:08 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:20:08 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:20:08 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
Retry #2 loading model: tts
2025-05-08 16:20:09 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:20:09 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:20:09 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
Retry #3 loading model: tts
2025-05-08 16:20:11 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:20:11 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:20:11 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:20:11 - tts - ❌ ERROR - Error getting available voices: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/tts.py", line 352, in get_available_voices
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 530, in run_model
    model_info = await self.load_model(model_type)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 163, in load_model
    model_info = await self.loader.load_model_async(model_type_str, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 780, in load_model_async
    return await loop.run_in_executor(
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 782, in <lambda>
    lambda: self.load_model(model_type, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:20:11 - httptools_impl - ✓ INFO - 127.0.0.1:55173 - "GET /pipeline/tts/voices HTTP/1.1" 200
2025-05-08 16:20:11 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:20:11 - httptools_impl - ✓ INFO - 127.0.0.1:55174 - "POST /pipeline/tts HTTP/1.1" 200
2025-05-08 16:20:11 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:20:11 - httptools_impl - ✓ INFO - 127.0.0.1:55175 - "GET /pipeline/tts/audio/442e655d58a5871e6c83ad0be9928770.mp3 HTTP/1.1" 200
2025-05-08 16:20:11 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:20:11 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:20:11 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:20:11 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:20:11 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:20:11 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:20:11 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:20:12 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:20:12 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:20:12 - httptools_impl - ✓ INFO - 127.0.0.1:55179 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:21:28 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:21:28 - httptools_impl - ✓ INFO - 127.0.0.1:55266 - "POST /pipeline/tts HTTP/1.1" 200
2025-05-08 16:21:28 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:21:28 - httptools_impl - ✓ INFO - 127.0.0.1:55267 - "GET /pipeline/tts/audio/fc40c2e0a389a0b480027f8e85547a00.mp3 HTTP/1.1" 200
2025-05-08 16:21:28 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:21:28 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:21:28 - pipeline - ✓ INFO - Detected error message in test STT result, providing fallback transcription
2025-05-08 16:21:28 - httptools_impl - ✓ INFO - 127.0.0.1:55268 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:21:41 - direct_tts - ✓ INFO - Direct TTS request: text='This is a test message in en language....', language=en
2025-05-08 16:21:41 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_6c2bef1f-bf33-4681-a6d2-0fcd940d13f7.mp3 (24192 bytes) in 0.16s
2025-05-08 16:21:41 - httptools_impl - ✓ INFO - 127.0.0.1:55308 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:21:41 - direct_tts - ✓ INFO - Direct TTS request: text='Este es un mensaje de prueba en español....', language=es
2025-05-08 16:21:41 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_2b2d9651-fe29-469a-af3c-9c3dbaa8a83b.mp3 (25152 bytes) in 0.19s
2025-05-08 16:21:41 - httptools_impl - ✓ INFO - 127.0.0.1:55312 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:21:41 - direct_tts - ✓ INFO - Direct TTS request: text='Ceci est un message de test en français....', language=fr
2025-05-08 16:21:42 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_53609b34-4c51-45eb-95e9-6ea91da8434e.mp3 (23232 bytes) in 0.13s
2025-05-08 16:21:42 - httptools_impl - ✓ INFO - 127.0.0.1:55315 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:21:52 - httptools_impl - ✓ INFO - 127.0.0.1:55332 - "POST /pipeline/tts HTTP/1.1" 422
2025-05-08 16:21:52 - httptools_impl - ✓ INFO - 127.0.0.1:55335 - "POST /pipeline/tts HTTP/1.1" 422
2025-05-08 16:21:52 - httptools_impl - ✓ INFO - 127.0.0.1:55337 - "POST /pipeline/tts HTTP/1.1" 422
2025-05-08 16:21:59 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:21:59 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:21:59 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:21:59 - manager - ✓ INFO - Model tts not loaded, loading now
Enhanced loading of model: tts
2025-05-08 16:21:59 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
Loading model: tts
2025-05-08 16:21:59 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:21:59 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:21:59 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
Retry #2 loading model: tts
2025-05-08 16:22:00 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:22:00 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:22:00 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
Retry #3 loading model: tts
2025-05-08 16:22:02 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:22:02 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:22:02 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:22:02 - tts - ❌ ERROR - Error using TTS model: Unsupported model type: pipeline
2025-05-08 16:22:02 - tts - ✓ INFO - Creating emergency audio content with gTTS
2025-05-08 16:22:02 - tts - ✓ INFO - Created emergency audio with gTTS: 49728 bytes
2025-05-08 16:22:02 - tts - ❌ ERROR - Error synthesizing speech: local variable 'result' referenced before assignment
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/tts.py", line 283, in synthesize
    metadata = result.get("metadata", {})
UnboundLocalError: local variable 'result' referenced before assignment
2025-05-08 16:22:02 - tts - ✓ INFO - Using fallback TTS implementation
2025-05-08 16:22:02 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:02 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate from English to fluent Spanish Pay atten...
2025-05-08 16:22:02 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:02 - wrapper - ✓ INFO - Applied enhanced generation parameters for en->es
2025-05-08 16:22:02 - veracity - ✓ INFO - [Basic Validation] Length ratio outside expected range for en->None
2025-05-08 16:22:02 - veracity - ✓ INFO - [Content Integrity] Entity preservation low: 0.00
2025-05-08 16:22:02 - wrapper - ✓ INFO - Using pre-computed veracity data with score: 0.5
2025-05-08 16:22:02 - wrapper - ✓ INFO - Successfully decoded 1 translation(s)
2025-05-08 16:22:03 - httptools_impl - ✓ INFO - 127.0.0.1:55345 - "POST /pipeline/tts HTTP/1.1" 200
2025-05-08 16:22:13 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:13 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:13 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:13 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:22:13 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:13 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:22:13 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:13 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:22:14 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:14 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:14 - httptools_impl - ✓ INFO - 127.0.0.1:55377 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:22:21 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:21 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:21 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:21 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:22:21 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:21 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:22:21 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:21 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:22:21 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:21 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:21 - httptools_impl - ✓ INFO - 127.0.0.1:55397 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:22:29 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:29 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:29 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:29 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:22:29 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:29 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:22:29 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:29 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:22:30 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:30 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:30 - pipeline - ✓ INFO - Detected error message in test STT result, providing fallback transcription
2025-05-08 16:22:30 - httptools_impl - ✓ INFO - 127.0.0.1:55419 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:22:34 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:34 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:34 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:34 - stt - ❌ ERROR - Error getting supported languages: Unknown method get_languages
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 309, in get_supported_languages
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method get_languages
2025-05-08 16:22:34 - httptools_impl - ✓ INFO - 127.0.0.1:55434 - "GET /pipeline/stt/languages HTTP/1.1" 200
2025-05-08 16:22:34 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:34 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:34 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:34 - manager - ✓ INFO - Model tts not loaded, loading now
Enhanced loading of model: tts
2025-05-08 16:22:34 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
Loading model: tts
2025-05-08 16:22:34 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:22:34 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:22:34 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
Retry #2 loading model: tts
2025-05-08 16:22:35 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:22:35 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:22:35 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
Retry #3 loading model: tts
2025-05-08 16:22:37 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:22:37 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:22:37 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:22:37 - tts - ❌ ERROR - Error getting available voices: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/tts.py", line 352, in get_available_voices
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 530, in run_model
    model_info = await self.load_model(model_type)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 163, in load_model
    model_info = await self.loader.load_model_async(model_type_str, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 780, in load_model_async
    return await loop.run_in_executor(
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 782, in <lambda>
    lambda: self.load_model(model_type, **kwargs)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1029, in load_model
    return self.load_model(model_type, **retry_options)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:22:37 - httptools_impl - ✓ INFO - 127.0.0.1:55435 - "GET /pipeline/tts/voices HTTP/1.1" 200
2025-05-08 16:22:37 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:37 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:37 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:37 - httptools_impl - ✓ INFO - 127.0.0.1:55438 - "POST /pipeline/tts HTTP/1.1" 200
2025-05-08 16:22:37 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:37 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:37 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:37 - httptools_impl - ✓ INFO - 127.0.0.1:55439 - "GET /pipeline/tts/audio/442e655d58a5871e6c83ad0be9928770.mp3 HTTP/1.1" 200
2025-05-08 16:22:38 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:22:38 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:22:38 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:22:38 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:22:38 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:38 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:22:38 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:22:38 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:22:38 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:38 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:22:38 - httptools_impl - ✓ INFO - 127.0.0.1:55441 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:22:47 - direct_tts - ✓ INFO - Direct TTS request: text='This is a direct test of the Text-to-Speech system...', language=en
2025-05-08 16:22:47 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_e2eafe46-b82b-475f-b9bf-bd82d0b2e97e.mp3 (38592 bytes) in 0.21s
2025-05-08 16:22:47 - httptools_impl - ✓ INFO - 127.0.0.1:55458 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:23:04 - direct_tts - ✓ INFO - Direct TTS request: text='This is a final test of the speech processing work...', language=en
2025-05-08 16:23:04 - direct_tts - ✓ INFO - Speech generated successfully: temp/direct_tts_8c63e776-0a35-4b21-8d03-049de60839d4.mp3 (31488 bytes) in 0.19s
2025-05-08 16:23:04 - httptools_impl - ✓ INFO - 127.0.0.1:55490 - "POST /direct_tts/generate HTTP/1.1" 200
2025-05-08 16:23:04 - auth - ✓ INFO - Auth check - Environment: development
2025-05-08 16:23:04 - auth - ⚠️ WARNING - 🧪 Development mode active — Auth bypass enabled, returning dev user
2025-05-08 16:23:04 - auth - ⚠️ WARNING - 🔓 AUTH BYPASS: Dev user authenticated with admin role (ENV=development)
2025-05-08 16:23:04 - stt - ✓ INFO - Method 'transcribe' not available: Unknown method transcribe. Trying 'process' instead.
2025-05-08 16:23:04 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:23:04 - wrapper - ✓ INFO - Enhanced MT5 prompts: Translate accurately while maintaining natural lan...
2025-05-08 16:23:04 - translation_prompt_enhancer - ✓ INFO - Advanced translation prompt enhancer initialized
2025-05-08 16:23:04 - wrapper - ✓ INFO - Applied enhanced generation parameters for None->en
2025-05-08 16:23:05 - wrapper - ❌ ERROR - Error in model processing: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'
2025-05-08 16:23:05 - manager - ❌ ERROR - Error in model processing: Error processing model: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/core/pipeline/stt.py", line 175, in transcribe
    result = await self.model_manager.run_model(
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 636, in run_model
    raise ValueError(f"Unknown method {method_name}")
ValueError: Unknown method transcribe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 164, in process
    output = self._postprocess(model_output, input_data)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 996, in _postprocess
    logger.info(f"Using pre-computed veracity data with score: {veracity_data.get('score', 0.0)}")
AttributeError: 'NoneType' object has no attribute 'get'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 586, in run_model
    result = await wrapper.process(model_input)
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/wrapper.py", line 170, in process
    raise APIError(
app.utils.error_handler.APIError: Error processing model: 'NoneType' object has no attribute 'get'
2025-05-08 16:23:05 - httptools_impl - ✓ INFO - 127.0.0.1:55493 - "POST /pipeline/stt HTTP/1.1" 200
2025-05-08 16:23:06 - metrics - ✓ INFO - Metrics saved to logs/metrics/metrics_20250508_162306.json
2025-05-08 16:23:06 - metrics - ✓ INFO - Cleaning up metrics files older than 2025-04-08T16:23:06.013321
2025-05-08 16:23:14 - metrics - ✓ INFO - Metrics saved to logs/metrics/metrics_20250508_162314.json
2025-05-08 16:23:14 - metrics - ✓ INFO - Cleaning up metrics files older than 2025-04-08T16:23:14.120878
WARNING:  WatchFiles detected changes in 'scripts/fix_tts_model.py'. Reloading...
2025-05-08 16:27:57 - server - ✓ INFO - Shutting down
2025-05-08 16:27:57 - server - ✓ INFO - Waiting for background tasks to complete. (CTRL+C to force quit)
2025-05-08 16:28:05 - on - ✓ INFO - Waiting for application shutdown.
2025-05-08 16:28:05 - main - ✓ INFO - Initiating graceful shutdown sequence...
────────────────────────────────────────────────────────────────────────── Server Shutdown Initiated ───────────────────────────────────────────────────────────────────────────
Starting shutdown sequence...
2025-05-08 16:28:05 - main - ✓ INFO - Flushing audit logs...
Flushing audit logs...
2025-05-08 16:28:05 - main - ✓ INFO - ✓ Audit logs flushed successfully
✓ Audit logs flushed successfully
2025-05-08 16:28:05 - main - ✓ INFO - Saving performance metrics...
Saving performance metrics...
2025-05-08 16:28:05 - metrics - ✓ INFO - Metrics saved to logs/metrics/metrics_20250508_162805.json
2025-05-08 16:28:05 - main - ✓ INFO - ✓ Performance metrics saved successfully
✓ Performance metrics saved successfully
2025-05-08 16:28:05 - main - ✓ INFO - Cleaning up route cache...
Cleaning up route cache...
2025-05-08 16:28:05 - main - ✓ INFO - ✓ Route cache cleared successfully
✓ Route cache cleared successfully
2025-05-08 16:28:05 - main - ✓ INFO - Unloading models...
Unloading models...
2025-05-08 16:28:05 - manager - ✓ INFO - Unloading all models...
Unloading all models...
Unloading model: language_detection
✓ Model language_detection unloaded successfully
Unloading model: translation
✓ Model translation unloaded successfully
Unloading model: mbart_translation
✓ Model mbart_translation unloaded successfully
Unloading model: simplifier
✓ Model simplifier unloaded successfully
Unloading model: ner_detection
✓ Model ner_detection unloaded successfully
Unloading model: embedding_model
✓ Model embedding_model unloaded successfully
2025-05-08 16:28:06 - metrics - ✓ INFO - Metrics saved to logs/metrics/metrics_20250508_162806.json
2025-05-08 16:28:06 - metrics - ✓ INFO - Cleaning up metrics files older than 2025-04-08T16:28:06.087369
Unloading model: anonymizer
✓ Model anonymizer unloaded successfully
Unloading model: speech_to_text
✓ Model speech_to_text unloaded successfully
Unloading model: tts_fallback
✓ Model tts_fallback unloaded successfully
  Unloading tts_fallback... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:01
2025-05-08 16:28:06 - manager - ✓ INFO - All models unloaded successfully
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ All models unloaded successfully                                                                                                                                           │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:06 - main - ✓ INFO - ✓ Models unloaded successfully
✓ Models unloaded successfully
2025-05-08 16:28:06 - main - ✓ INFO - Final CUDA resource cleanup...
Performing final CUDA resource cleanup...
2025-05-08 16:28:06 - main - ✓ INFO - ✓ CUDA resources cleaned up
✓ CUDA resources cleaned up
2025-05-08 16:28:06 - main - ✓ INFO - Cleaning up session manager...
Cleaning up session manager...
2025-05-08 16:28:06 - session_manager - ✓ INFO - Cleaning up session manager
2025-05-08 16:28:06 - session_manager - ✓ INFO - Session cleanup task cancelled
2025-05-08 16:28:06 - session_manager - ✓ INFO - Session manager cleanup complete
2025-05-08 16:28:06 - main - ✓ INFO - ✓ Session manager cleaned up
✓ Session manager cleaned up
2025-05-08 16:28:06 - main - ✓ INFO - ✓ CasaLingua server shutdown completed successfully in 1.61s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ CasaLingua server shutdown completed successfully                                                                                                                          │
│ Time taken: 1.61s                                                                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:06 - on - ✓ INFO - Application shutdown complete.
2025-05-08 16:28:06 - server - ✓ INFO - Finished server process [11524]
2025-05-08 16:28:06 - metrics - ✓ INFO - Metrics save task cancelled
2025-05-08 16:28:06 - logger - ✓ INFO - Audit log cleanup task cancelled
2025-05-08 16:28:06 - metrics - ✓ INFO - Metrics save task cancelled
2025-05-08 16:28:06 - logger - ✓ INFO - Audit log flush task cancelled
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
🔧 Starting CasaLingua in development mode
🚧 Dev mode active: DEBUG logging enabled, hot reload expected.
2025-05-08 16:28:11 - session_manager - ✓ INFO - Session manager initialized with 3600s TTL, 300s cleanup interval
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-05-08 16:28:11 - server - ✓ INFO - Started server process [16875]
2025-05-08 16:28:11 - on - ✓ INFO - Waiting for application startup.

╔════════════════════════════════════════════════════════════════════════════╗
║                                                                            ║
║      _____                _      _                                                             ║
║     / ____|              | |    (_)                                                            ║
║    | |     __ _ ___  __ _| |     _ _ __   __ _ _   _  __ _                                     ║
║    | |    / _` / __|/ _` | |    | | '_ \ / _` | | | |/ _` |                                    ║
║    | |___| (_| \__ \ (_| | |____| | | | | (_| | |_| | (_| |                                    ║
║     \_____\__,_|___/\__,_|______|_|_| |_|\__, |\__,_|\__,_|                                    ║
║                                           |___/                                                ║
║                                                                            ║
║   Language Processing & Translation Pipeline                               ║
║   Version: 1.0.0                                                           ║
║                                                                            ║
╚════════════════════════════════════════════════════════════════════════════╝

2025-05-08 16:28:11 - config - 🔍 DEBUG - Loaded default config (values omitted)
2025-05-08 16:28:11 - config - 🔍 DEBUG - Loaded environment-specific config (values omitted)
2025-05-08 16:28:11 - config - 🔍 DEBUG - Loaded environment variables config (values omitted)
2025-05-08 16:28:11 - config - ⚠️ WARNING - Missing required config keys: server_host, server_port, log_level, models_dir, log_dir, using defaults
2025-05-08 16:28:11 - config - 🔍 DEBUG - Validated config merged from: default: config/default.json, development: config/development.json, environment variables
2025-05-08 16:28:11 - config - ✓ INFO - Configuration changed for environment 'development', notifying 0 callbacks
2025-05-08 16:28:11 - main - ✓ INFO - Environment: development
2025-05-08 16:28:11 - main - ✓ INFO - Python version: 3.10.13
2025-05-08 16:28:11 - main - ✓ INFO - Server time: 2025-05-08 16:28:11
2025-05-08 16:28:11 - logging - ✓ INFO - Logging configured - Level: INFO, Environment: development
──────────────────────────────────────────────────────────────────────── 🚀 PHASE 1: Detecting Hardware ────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:11 - main - ✓ INFO - PHASE 1/5: Detecting hardware capabilities...
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Starting simplified hardware detection...
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected M4 Pro/Max with 48GB RAM configuration
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected Apple Silicon: M4 M4 Pro/Max
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected system: Darwin Darwin Kernel Version 24.5.0: Tue Apr 22 19:53:27 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6041
2025-05-08 16:28:11 - simple_detector - ✓ INFO - System detection complete
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected 48GB memory configuration (M4 Pro/Max)
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Enhanced memory detection: 28.32 GB available
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected Memory: 48.0 GB total, 28.32 GB available
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Memory Model: high_capacity
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Memory detection complete
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected Apple M4 Max with 16 logical cores
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected CPU: Apple M4 Max with 16 logical cores
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Apple Silicon variant: M4 Max
2025-05-08 16:28:11 - simple_detector - ✓ INFO - CPU detection complete
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Detected Apple M4 Pro Integrated GPU with MPS support
2025-05-08 16:28:11 - simple_detector - ✓ INFO - GPU has 28 compute units
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Neural Engine: 16 cores
2025-05-08 16:28:11 - simple_detector - ✓ INFO - GPU detection complete
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Hardware Summary: Darwin Darwin Kernel Version 24.5.0: Tue Apr 22 19:53:27 PDT 2025; root:xnu-11417.121.6~2/RELEASE_ARM64_T6041, Apple M4 Max (16 cores), 48.0GB RAM, GPU: Available
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended device: mps
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommending enhanced configuration for M4 Pro/Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Optimized for Apple M4 Max with 48GB RAM
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended batch size: 128
2025-05-08 16:28:11 - simple_detector - ✓ INFO - Recommended sequence length: 4096
2025-05-08 16:28:11 - main - ✓ INFO - 🧠 Auto-upgraded model_size to 'medium' based on hardware detection
2025-05-08 16:28:11 - main - ✓ INFO - ✓ Hardware detection complete
────────────────────────────────────────────────────────────────────────── 🔧 PHASE 2: Loading Models ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:11 - main - ✓ INFO - PHASE 2/5: Initializing model loader...
2025-05-08 16:28:11 - loader - ✓ INFO - Loaded model registry from config/model_registry.json
2025-05-08 16:28:11 - loader - ✓ INFO - Loaded model registry from config/model_registry.json
2025-05-08 16:28:11 - loader - ✓ INFO - Updated model registry with 11 entries
                                       Model Registry                                       
┏━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Model Type         ┃ Model                                       ┃ Framework             ┃
┡━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩
│ language_detection │ papluca/xlm-roberta-base-language-detection │ transformers          │
│ translation        │ facebook/nllb-200-1.3B                      │ transformers          │
│ mbart_translation  │ facebook/mbart-large-50-many-to-many-mmt    │ transformers          │
│ mt5_translation    │ google/mt5-small                            │ transformers          │
│ ner_detection      │ dslim/bert-base-NER                         │ transformers          │
│ simplifier         │ facebook/bart-large-cnn                     │ transformers          │
│ tts                │ espnet/kan-bayashi_ljspeech_vits            │ transformers          │
│ rag_generator      │ google/mt5-base                             │ transformers          │
│ anonymizer         │ bert-base-cased                             │ transformers          │
│ rag_retriever      │ sentence-transformers/all-mpnet-base-v2     │ sentence-transformers │
│ embedding_model    │ sentence-transformers/all-mpnet-base-v2     │ sentence-transformers │
└────────────────────┴─────────────────────────────────────────────┴───────────────────────┘
2025-05-08 16:28:11 - loader - ✓ INFO - Discovered MPS device (Apple Silicon)
2025-05-08 16:28:11 - loader - ✓ INFO - ModelLoader initialized with available devices: mps, cpu
ModelLoader initialized - Available devices: mps, cpu
Default device: mps
2025-05-08 16:28:11 - main - ✓ INFO - Checking for required models and downloading if necessary...
2025-05-08 16:28:11 - main - ✓ INFO - Model translation_model already exists, skipping download
2025-05-08 16:28:11 - main - ✓ INFO - Model translation_small already exists, skipping download
2025-05-08 16:28:11 - main - ✓ INFO - Model language_detection already exists, skipping download
2025-05-08 16:28:11 - main - ✓ INFO - Initializing enhanced model manager...
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Enhanced Model Manager Initialized                                                                                                                                           │
│ Device: mps, Precision: float16                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:11 - main - ✓ INFO - PHASE 2b: Bootstrapping all models before exposing API...

Bootstrapping Essential Models
Loading Tier 1 (Critical) Models...
2025-05-08 16:28:11 - loader - ✓ INFO - Loading critical model: language_detection...
Loading language_detection...
Loading model: language_detection
2025-05-08 16:28:11 - loader - ✓ INFO - Loading language_detection (papluca/xlm-roberta-base-language-detection)
Loading language_detection (papluca/xlm-roberta-base-language-detection)
2025-05-08 16:28:11 - loader - ✓ INFO - Loading tokenizer for language_detection...
Loading tokenizer for language_detection...
2025-05-08 16:28:11 - loader - ✓ INFO - Loading tokenizer: papluca/xlm-roberta-base-language-detection
2025-05-08 16:28:11 - loader - ✓ INFO - Loading model for language_detection...
Loading model for language_detection...
2025-05-08 16:28:11 - loader - ✓ INFO - Loading Transformers model: papluca/xlm-roberta-base-language-detection on mps
2025-05-08 16:28:13 - loader - ✓ INFO - Successfully loaded papluca/xlm-roberta-base-language-detection on mps
2025-05-08 16:28:13 - loader - ✓ INFO - Finalizing language_detection model...
Finalizing language_detection model...
2025-05-08 16:28:13 - loader - ✓ INFO - Model language_detection loaded successfully!
Model language_detection loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: language_detection                                                                                                                              │
│ Loaded in 2.00s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:13 - loader - ✓ INFO - Bootstrapped critical model language_detection in 2.20s
✓ Loaded language_detection in 2.20s
2025-05-08 16:28:13 - loader - ✓ INFO - Loading critical model: translation...
Loading translation...
Loading model: translation
2025-05-08 16:28:13 - loader - ✓ INFO - Loading translation (facebook/nllb-200-1.3B)
Loading translation (facebook/nllb-200-1.3B)
2025-05-08 16:28:13 - loader - ✓ INFO - Loading tokenizer for translation...
Loading tokenizer for translation...
2025-05-08 16:28:13 - loader - ✓ INFO - Loading tokenizer: facebook/nllb-200-1.3B
2025-05-08 16:28:14 - loader - ✓ INFO - Loading model for translation...
Loading model for translation...
2025-05-08 16:28:14 - loader - ⚠️ WARNING - ⚠️ Forcing CPU device for facebook/nllb-200-1.3B due to MPS compatibility issues
2025-05-08 16:28:14 - loader - ✓ INFO - Loading Transformers model: facebook/nllb-200-1.3B on cpu
2025-05-08 16:28:22 - loader - ✓ INFO - Successfully loaded facebook/nllb-200-1.3B on cpu
2025-05-08 16:28:22 - loader - ✓ INFO - Finalizing translation model...
Finalizing translation model...
2025-05-08 16:28:22 - loader - ✓ INFO - Model translation loaded successfully!
Model translation loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: translation                                                                                                                                     │
│ Loaded in 8.82s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:22 - loader - ✓ INFO - Bootstrapped critical model translation in 9.03s
✓ Loaded translation in 9.03s
Loading Tier 2 (Important) Models...
2025-05-08 16:28:22 - loader - ✓ INFO - Loading important model: ner_detection...
Loading ner_detection...
Loading model: ner_detection
2025-05-08 16:28:22 - loader - ✓ INFO - Loading ner_detection (dslim/bert-base-NER)
Loading ner_detection (dslim/bert-base-NER)
2025-05-08 16:28:22 - loader - ✓ INFO - Loading tokenizer for ner_detection...
Loading tokenizer for ner_detection...
2025-05-08 16:28:22 - loader - ✓ INFO - Loading tokenizer: dslim/bert-base-NER
2025-05-08 16:28:22 - loader - ✓ INFO - Loading model for ner_detection...
Loading model for ner_detection...
2025-05-08 16:28:22 - loader - ✓ INFO - Loading Transformers model: dslim/bert-base-NER on mps
2025-05-08 16:28:23 - loader - ✓ INFO - Successfully loaded dslim/bert-base-NER on mps
2025-05-08 16:28:23 - loader - ✓ INFO - Finalizing ner_detection model...
Finalizing ner_detection model...
2025-05-08 16:28:23 - loader - ✓ INFO - Model ner_detection loaded successfully!
Model ner_detection loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: ner_detection                                                                                                                                   │
│ Loaded in 0.55s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:23 - loader - ✓ INFO - Bootstrapped important model ner_detection in 0.75s
✓ Loaded ner_detection in 0.75s
2025-05-08 16:28:23 - loader - ✓ INFO - Loading important model: simplifier...
Loading simplifier...
Loading model: simplifier
2025-05-08 16:28:23 - loader - ✓ INFO - Loading simplifier (facebook/bart-large-cnn)
Loading simplifier (facebook/bart-large-cnn)
2025-05-08 16:28:23 - loader - ✓ INFO - Loading tokenizer for simplifier...
Loading tokenizer for simplifier...
2025-05-08 16:28:23 - loader - ✓ INFO - Loading tokenizer: facebook/bart-large-cnn
2025-05-08 16:28:25 - loader - ✓ INFO - Loading model for simplifier...
Loading model for simplifier...
2025-05-08 16:28:25 - loader - ✓ INFO - Loading Transformers model: facebook/bart-large-cnn on mps
2025-05-08 16:28:27 - loader - ✓ INFO - Successfully loaded facebook/bart-large-cnn on mps
2025-05-08 16:28:27 - loader - ✓ INFO - Finalizing simplifier model...
Finalizing simplifier model...
2025-05-08 16:28:27 - loader - ✓ INFO - Model simplifier loaded successfully!
Model simplifier loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: simplifier                                                                                                                                      │
│ Loaded in 3.99s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:27 - loader - ✓ INFO - Bootstrapped important model simplifier in 4.19s
✓ Loaded simplifier in 4.19s
Registering Tier 3 (On-demand) Models for lazy loading...
2025-05-08 16:28:27 - loader - ✓ INFO - Registered 3 models for lazy loading: rag_generator, rag_retriever, anonymizer
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Progressive model bootstrap successful                                                                                                                                     │
│ Loaded 4 models immediately                                                                                                                                                  │
│ Registered 3 models for lazy loading                                                                                                                                         │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:28 - main - ✓ INFO - ✓ Model system initialized
2025-05-08 16:28:28 - main - ✓ INFO - Initializing shared tokenizer pipeline...
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/transformers/convert_slow_tokenizer.py:446: UserWarning: The sentencepiece tokenizer that you are converting to a fast tokenizer uses the byte fallback option which is not implemented in the fast tokenizers. In practice this means that the fast version of the tokenizer can produce unknown tokens whereas the sentencepiece version would have converted these unknown tokens into a sequence of byte tokens matching the original piece of text.
  warnings.warn(
2025-05-08 16:28:29 - tokenizer - ✓ INFO - ✓ Loaded tokenizer: google/mt5-small
───────────────────────────────────────────────────────────────────────── 🧾 PHASE 3: Audit & Metrics ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:29 - main - ✓ INFO - PHASE 3/5: Starting audit system...
2025-05-08 16:28:29 - logger - ✓ INFO - Audit logger initialized
2025-05-08 16:28:29 - metrics - ✓ INFO - Metrics collector initialized
2025-05-08 16:28:29 - logger - ✓ INFO - Initializing audit logger...
2025-05-08 16:28:29 - logger - ✓ INFO - Audit logger initialization complete
2025-05-08 16:28:29 - main - ✓ INFO - ✓ Audit system initialized
────────────────────────────────────────────────────────────────────────── 🗄️ PHASE 3.5: Database Init ──────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:29 - main - ✓ INFO - PHASE 3.5/5: Initializing database persistence...
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Created health check table in ./data/users.db
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Created health check table in ./data/content.db
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Created health check table in ./data/progress.db
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Initialized and validated persistence manager
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Verifying database connections...
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Verified users database connection: 453 health check records
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Verified content database connection: 453 health check records
2025-05-08 16:28:29 - persistence_init - ✓ INFO - Verified progress database connection: 453 health check records
2025-05-08 16:28:29 - main - ✓ INFO - ✓ Database persistence initialized
────────────────────────────────────────────────────────────────────────── 🧠 PHASE 4: Pipeline Init ───────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:29 - main - ✓ INFO - PHASE 4/5: Setting up processing pipeline...
2025-05-08 16:28:29 - main - ✓ INFO - Eagerly loading essential models...
2025-05-08 16:28:29 - main - ✓ INFO - Preloading language_detection model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading translation model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading mbart_translation model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading simplifier model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading ner_detection model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading embedding_model model
2025-05-08 16:28:29 - main - ✓ INFO - Preloading anonymizer model
Enhanced loading of model: language_detection
2025-05-08 16:28:29 - manager - ✓ INFO - Loading language_detection model with float16 precision...
Loading language_detection model with float16 precision...
Loading model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:28:29 - manager - ✓ INFO - Model language_detection loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: language_detection in 0.00s                                                                                                                     │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:29 - main - ✓ INFO - ✓ language_detection model loaded successfully
Enhanced loading of model: translation
2025-05-08 16:28:29 - manager - ✓ INFO - Loading translation model with float16 precision...
Loading translation model with float16 precision...
Loading model: translation
✓ Model translation already loaded from cache
2025-05-08 16:28:29 - manager - ✓ INFO - Model translation loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: translation in 0.00s                                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:29 - main - ✓ INFO - ✓ translation model loaded successfully
Enhanced loading of model: mbart_translation
2025-05-08 16:28:29 - manager - ✓ INFO - Loading mbart_translation model with float16 precision...
Loading mbart_translation model with float16 precision...
Loading model: mbart_translation
2025-05-08 16:28:29 - loader - ✓ INFO - Loading mbart_translation (facebook/mbart-large-50-many-to-many-mmt)
Loading mbart_translation (facebook/mbart-large-50-many-to-many-mmt)
2025-05-08 16:28:29 - loader - ✓ INFO - Loading tokenizer for mbart_translation...
Loading tokenizer for mbart_translation...
2025-05-08 16:28:29 - loader - ✓ INFO - Loading tokenizer: facebook/mbart-large-50-many-to-many-mmt
2025-05-08 16:28:29 - loader - ✓ INFO - Loading specialized MBART tokenizer for facebook/mbart-large-50-many-to-many-mmt
2025-05-08 16:28:31 - loader - ✓ INFO - Successfully loaded MBART tokenizer using AutoTokenizer
2025-05-08 16:28:31 - loader - ✓ INFO - Loading model for mbart_translation...
Loading model for mbart_translation...
2025-05-08 16:28:31 - loader - ⚠️ WARNING - ⚠️ Forcing CPU device for facebook/mbart-large-50-many-to-many-mmt due to MPS compatibility issues
2025-05-08 16:28:31 - loader - ✓ INFO - Loading Transformers model: facebook/mbart-large-50-many-to-many-mmt on cpu
2025-05-08 16:28:36 - loader - ✓ INFO - Successfully loaded facebook/mbart-large-50-many-to-many-mmt on cpu
2025-05-08 16:28:36 - loader - ✓ INFO - Finalizing mbart_translation model...
Finalizing mbart_translation model...
2025-05-08 16:28:36 - loader - ✓ INFO - Model mbart_translation loaded successfully!
Model mbart_translation loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: mbart_translation                                                                                                                               │
│ Loaded in 6.76s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:36 - manager - ✓ INFO - Model mbart_translation loaded successfully in 6.97s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: mbart_translation in 6.97s                                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:36 - main - ✓ INFO - ✓ mbart_translation model loaded successfully
Enhanced loading of model: simplifier
2025-05-08 16:28:36 - manager - ✓ INFO - Loading simplifier model with float16 precision...
Loading simplifier model with float16 precision...
Loading model: simplifier
✓ Model simplifier already loaded from cache
2025-05-08 16:28:36 - manager - ✓ INFO - Model simplifier loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: simplifier in 0.00s                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:36 - main - ✓ INFO - ✓ simplifier model loaded successfully
Enhanced loading of model: ner_detection
2025-05-08 16:28:36 - manager - ✓ INFO - Loading ner_detection model with float16 precision...
Loading ner_detection model with float16 precision...
Loading model: ner_detection
✓ Model ner_detection already loaded from cache
2025-05-08 16:28:36 - manager - ✓ INFO - Model ner_detection loaded successfully in 0.00s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: ner_detection in 0.00s                                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:36 - main - ✓ INFO - ✓ ner_detection model loaded successfully
Enhanced loading of model: embedding_model
2025-05-08 16:28:36 - manager - ✓ INFO - Loading embedding_model model with float16 precision...
Loading embedding_model model with float16 precision...
Loading model: embedding_model
2025-05-08 16:28:36 - loader - ✓ INFO - Loading embedding_model (sentence-transformers/all-mpnet-base-v2)
Loading embedding_model (sentence-transformers/all-mpnet-base-v2)
2025-05-08 16:28:36 - loader - ✓ INFO - Loading embedding model for embedding_model...
Loading embedding model for embedding_model...
2025-05-08 16:28:36 - loader - ✓ INFO - Loading SentenceTransformer model: sentence-transformers/all-mpnet-base-v2
2025-05-08 16:28:36 - SentenceTransformer - ✓ INFO - Load pretrained SentenceTransformer: sentence-transformers/all-mpnet-base-v2
2025-05-08 16:28:37 - loader - ✓ INFO - Finalizing embedding_model model...
Finalizing embedding_model model...
2025-05-08 16:28:37 - loader - ✓ INFO - Model embedding_model loaded successfully!
Model embedding_model loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: embedding_model                                                                                                                                 │
│ Loaded in 0.37s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:37 - manager - ✓ INFO - Model embedding_model loaded successfully in 0.57s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: embedding_model in 0.57s                                                                                                                        │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:37 - main - ✓ INFO - ✓ embedding_model model loaded successfully
Enhanced loading of model: anonymizer
2025-05-08 16:28:37 - manager - ✓ INFO - Loading anonymizer model with float16 precision...
Loading anonymizer model with float16 precision...
2025-05-08 16:28:37 - loader - ✓ INFO - Recorded first request for lazy-load model: anonymizer
Loading model: anonymizer
2025-05-08 16:28:37 - loader - ✓ INFO - Loading anonymizer (bert-base-cased)
Loading anonymizer (bert-base-cased)
2025-05-08 16:28:37 - loader - ✓ INFO - Loading tokenizer for anonymizer...
Loading tokenizer for anonymizer...
2025-05-08 16:28:37 - loader - ✓ INFO - Loading tokenizer: bert-base-cased
2025-05-08 16:28:37 - loader - ✓ INFO - Loading model for anonymizer...
Loading model for anonymizer...
2025-05-08 16:28:37 - loader - ✓ INFO - Loading Transformers model: bert-base-cased on mps
2025-05-08 16:28:37 - loader - ✓ INFO - Successfully loaded bert-base-cased on mps
2025-05-08 16:28:37 - loader - ✓ INFO - Finalizing anonymizer model...
Finalizing anonymizer model...
2025-05-08 16:28:37 - loader - ✓ INFO - Model anonymizer loaded successfully!
Model anonymizer loaded successfully!
2025-05-08 16:28:37 - loader - ✓ INFO - Lazy-loaded model anonymizer after 1 requests
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: anonymizer                                                                                                                                      │
│ Loaded in 0.66s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:38 - manager - ✓ INFO - Model anonymizer loaded successfully in 0.87s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: anonymizer in 0.87s                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:38 - main - ✓ INFO - ✓ anonymizer model loaded successfully
2025-05-08 16:28:38 - main - ✓ INFO - Essential model preloading complete
2025-05-08 16:28:38 - logger - ✓ INFO - Audit logger initialized
2025-05-08 16:28:38 - metrics - ✓ INFO - Metrics collector initialized
2025-05-08 16:28:38 - veracity - ✓ INFO - Veracity auditor initialized
2025-05-08 16:28:38 - processor - ✓ INFO - UnifiedProcessor initialized (components not yet loaded)
2025-05-08 16:28:38 - processor - ✓ INFO - Initializing UnifiedProcessor components
2025-05-08 16:28:38 - processor - ✓ INFO - Initializing translation pipeline
2025-05-08 16:28:38 - translator - ✓ INFO - Translation pipeline created (not yet initialized)
2025-05-08 16:28:38 - translator - ✓ INFO - Initializing translation pipeline
2025-05-08 16:28:38 - translator - ✓ INFO - Loading language detection model
Enhanced loading of model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:28:38 - translator - ✓ INFO - Language detection model ready
2025-05-08 16:28:38 - translator - ✓ INFO - Translation pipeline initialization complete
2025-05-08 16:28:38 - processor - ✓ INFO - Translation pipeline initialization complete
2025-05-08 16:28:38 - processor - ✓ INFO - Initializing language detector
2025-05-08 16:28:38 - language_detector - ✓ INFO - Language detector initialized (not yet loaded)
2025-05-08 16:28:38 - language_detector - ✓ INFO - Initializing language detector
Enhanced loading of model: language_detection
✓ Model language_detection already loaded from cache
2025-05-08 16:28:38 - language_detector - ✓ INFO - Language detection model loaded: unknown
2025-05-08 16:28:38 - language_detector - ✓ INFO - LangDetect library available for fallback
2025-05-08 16:28:38 - language_detector - ✓ INFO - NLTK available for fallback
2025-05-08 16:28:38 - language_detector - ✓ INFO - Language detector initialization complete
2025-05-08 16:28:38 - processor - ✓ INFO - Language detector initialization complete
2025-05-08 16:28:38 - processor - ✓ INFO - Initializing STT pipeline
2025-05-08 16:28:38 - stt - ✓ INFO - STT pipeline created (not yet initialized)
2025-05-08 16:28:38 - stt - ✓ INFO - Initializing STT pipeline
Enhanced loading of model: speech_to_text
2025-05-08 16:28:38 - manager - ✓ INFO - Loading speech_to_text model with float16 precision...
Loading speech_to_text model with float16 precision...
2025-05-08 16:28:38 - Loading model: speech_to_text
processor - ✓ INFO - Initializing TTS pipeline
2025-05-08 16:28:38 - loader - ⚠️ WARNING - No model configuration found for 'speech_to_text', using generic fallback
2025-05-08 16:28:38 - tts - ✓ INFO - TTS pipeline created (not yet initialized)
2025-05-08 16:28:38 - loader - ✓ INFO - Loading speech_to_text (google/mt5-small)
Loading speech_to_text (google/mt5-small)
2025-05-08 16:28:38 - tts - ✓ INFO - Initializing TTS pipeline
Enhanced loading of model: tts
2025-05-08 16:28:38 - loader - ✓ INFO - Loading tokenizer for speech_to_text...
Loading tokenizer for speech_to_text...
2025-05-08 16:28:38 - manager - ✓ INFO - Loading tts model with float16 precision...
Loading tts model with float16 precision...
2025-05-08 16:28:38 - Loading model: tts
loader - ✓ INFO - Loading tokenizer: google/mt5-small
2025-05-08 16:28:38 - processor - ✓ INFO - Initializing simplifier
2025-05-08 16:28:38 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
2025-05-08 16:28:38 - loader - ✓ INFO - Loading specialized MT5 tokenizer for google/mt5-smallError loading tts: Unsupported model type: pipeline

2025-05-08 16:28:38 - simplifier - ✓ INFO - Simplification pipeline created (not yet initialized)
2025-05-08 16:28:38 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:28:38 - simplifier - ✓ INFO - Initializing simplification pipeline
2025-05-08 16:28:38 - loader - ✓ INFO - Retrying model load for tts in 1s (attempt 2/3)
2025-05-08 16:28:38 - simplifier - ✓ INFO - Loading simplification model (simplifier)
Enhanced loading of model: simplifier
✓ Model simplifier already loaded from cache
2025-05-08 16:28:38 - simplifier - ✓ INFO - Simplification model loaded successfully
2025-05-08 16:28:38 - simplifier - ✓ INFO - Loaded grade level vocabulary for 2 grade levels
2025-05-08 16:28:38 - simplifier - ✓ INFO - Simplification pipeline initialization complete
2025-05-08 16:28:38 - processor - ✓ INFO - Simplifier initialization complete
Retry #2 loading model: tts
2025-05-08 16:28:39 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:28:39 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
2025-05-08 16:28:39 - loader - ✓ INFO - Retrying model load for tts in 2s (attempt 3/3)
2025-05-08 16:28:39 - loader - ✓ INFO - Successfully loaded MT5 tokenizer using AutoTokenizer
2025-05-08 16:28:39 - loader - ✓ INFO - Loading model for speech_to_text...
Loading model for speech_to_text...
2025-05-08 16:28:39 - loader - ✓ INFO - Loading Transformers model: google/mt5-small on mps
Retry #3 loading model: tts
2025-05-08 16:28:41 - loader - ✓ INFO - Loading tts (espnet/kan-bayashi_ljspeech_vits)
Loading tts (espnet/kan-bayashi_ljspeech_vits)
Error loading tts: Unsupported model type: pipeline
2025-05-08 16:28:41 - loader - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 970, in load_model
    raise ValueError(f"Unsupported model type: {model_config.type}")
ValueError: Unsupported model type: pipeline
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ⚠ Error loading model: tts                                                                                                                                                   │
│ Unsupported model type: pipeline                                                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:41 - manager - ❌ ERROR - Error loading model tts: Unsupported model type: pipeline
2025-05-08 16:28:41 - tts - ⚠️ WARNING - Error loading TTS model: Unsupported model type: pipeline
2025-05-08 16:28:41 - tts - ⚠️ WARNING - TTS functionality will be limited to fallbacks
2025-05-08 16:28:41 - tts - ✓ INFO - TTS pipeline initialization complete
2025-05-08 16:28:41 - processor - ✓ INFO - TTS pipeline initialization complete
2025-05-08 16:28:41 - loader - ✓ INFO - Successfully loaded google/mt5-small on mps
2025-05-08 16:28:41 - loader - ✓ INFO - Finalizing speech_to_text model...
Finalizing speech_to_text model...
2025-05-08 16:28:41 - loader - ✓ INFO - Model speech_to_text loaded successfully!
Model speech_to_text loaded successfully!
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: speech_to_text                                                                                                                                  │
│ Loaded in 3.61s                                                                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:41 - manager - ✓ INFO - Model speech_to_text loaded successfully in 3.81s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ Successfully loaded model: speech_to_text in 3.81s                                                                                                                         │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:28:41 - stt - ✓ INFO - STT model loaded successfully
2025-05-08 16:28:41 - stt - ✓ INFO - STT pipeline initialization complete
2025-05-08 16:28:41 - processor - ✓ INFO - STT pipeline initialization complete
2025-05-08 16:28:41 - processor - ✓ INFO - UnifiedProcessor initialization complete
2025-05-08 16:28:41 - main - ✓ INFO - ✓ Processing pipeline ready
──────────────────────────────────────────────────────────────────────────── 🌐 PHASE 5: API Ready ─────────────────────────────────────────────────────────────────────────────
2025-05-08 16:28:41 - main - ✓ INFO - PHASE 5/5: Initializing API endpoints...
2025-05-08 16:28:41 - main - ✓ INFO - Initializing route cache...
2025-05-08 16:28:41 - route_cache - ✓ INFO - Route cache 'default' initialized with max_size=1000, ttl_seconds=3600, bloom_compatible=True
2025-05-08 16:28:41 - route_cache - ✓ INFO - Route cache 'translation' initialized with max_size=2000, ttl_seconds=7200, bloom_compatible=True
2025-05-08 16:28:41 - main - ✓ INFO - ✓ Route cache initialized with 1000 entries default capacity
2025-05-08 16:28:41 - main - ✓ INFO - Initializing session manager cleanup task...
2025-05-08 16:28:41 - session_manager - ✓ INFO - Starting session cleanup task
2025-05-08 16:28:41 - main - ✓ INFO - ✓ Session manager cleanup task started
                   🔍 Hardware Summary                   
┏━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Component     ┃ Details                               ┃
┡━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ CPU           │ Apple M4_Max - 16 cores / 16 threads  │
│ Memory        │ 48.0 GB total / 28.3 GB available     │
│ GPU           │ Apple M4 Pro Integrated GPU (48.0 GB) │
│ Apple Silicon │ M4 Max with 48GB                      │
└───────────────┴───────────────────────────────────────┘
╭────────────────────────────────────────╮
│ 🎉 CasaLingua Boot Complete            │
│ System is ready and accepting requests │
╰────────────────────────────────────────╯
2025-05-08 16:28:41 - main - ✓ INFO - ✓ CasaLingua system initialization complete
2025-05-08 16:28:41 - main - ✓ INFO - ✓ Server is ready to accept connections!
2025-05-08 16:28:41 - session_manager - ✓ INFO - Starting session cleanup task with interval 300s
2025-05-08 16:28:41 - on - ✓ INFO - Application startup complete.
WARNING:  WatchFiles detected changes in 'scripts/fix_tts_model.py'. Reloading...
2025-05-08 16:31:44 - server - ✓ INFO - Shutting down
2025-05-08 16:31:44 - on - ✓ INFO - Waiting for application shutdown.
2025-05-08 16:31:44 - main - ✓ INFO - Initiating graceful shutdown sequence...
────────────────────────────────────────────────────────────────────────── Server Shutdown Initiated ───────────────────────────────────────────────────────────────────────────
Starting shutdown sequence...
2025-05-08 16:31:44 - main - ✓ INFO - Flushing audit logs...
Flushing audit logs...
2025-05-08 16:31:44 - main - ✓ INFO - ✓ Audit logs flushed successfully
✓ Audit logs flushed successfully
2025-05-08 16:31:44 - main - ✓ INFO - Saving performance metrics...
Saving performance metrics...
2025-05-08 16:31:44 - metrics - ✓ INFO - Metrics saved to logs/metrics/metrics_20250508_163144.json
2025-05-08 16:31:44 - main - ✓ INFO - ✓ Performance metrics saved successfully
✓ Performance metrics saved successfully
2025-05-08 16:31:44 - main - ✓ INFO - Cleaning up route cache...
Cleaning up route cache...
2025-05-08 16:31:44 - main - ✓ INFO - ✓ Route cache cleared successfully
✓ Route cache cleared successfully
2025-05-08 16:31:44 - main - ✓ INFO - Unloading models...
Unloading models...
2025-05-08 16:31:44 - manager - ✓ INFO - Unloading all models...
Unloading all models...
Unloading model: language_detection
✓ Model language_detection unloaded successfully
Unloading model: translation
✓ Model translation unloaded successfully
Unloading model: mbart_translation
✓ Model mbart_translation unloaded successfully
Unloading model: simplifier
✓ Model simplifier unloaded successfully
Unloading model: ner_detection
✓ Model ner_detection unloaded successfully
Unloading model: embedding_model
✓ Model embedding_model unloaded successfully
Unloading model: anonymizer
✓ Model anonymizer unloaded successfully
Unloading model: speech_to_text
✓ Model speech_to_text unloaded successfully
  Unloading speech_to_text... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:01
2025-05-08 16:31:46 - manager - ✓ INFO - All models unloaded successfully
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ All models unloaded successfully                                                                                                                                           │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:31:46 - main - ✓ INFO - ✓ Models unloaded successfully
✓ Models unloaded successfully
2025-05-08 16:31:46 - main - ✓ INFO - Final CUDA resource cleanup...
Performing final CUDA resource cleanup...
2025-05-08 16:31:46 - main - ✓ INFO - ✓ CUDA resources cleaned up
✓ CUDA resources cleaned up
2025-05-08 16:31:46 - main - ✓ INFO - Cleaning up session manager...
Cleaning up session manager...
2025-05-08 16:31:46 - session_manager - ✓ INFO - Cleaning up session manager
2025-05-08 16:31:46 - session_manager - ✓ INFO - Session cleanup task cancelled
2025-05-08 16:31:46 - session_manager - ✓ INFO - Session manager cleanup complete
2025-05-08 16:31:46 - main - ✓ INFO - ✓ Session manager cleaned up
✓ Session manager cleaned up
2025-05-08 16:31:46 - main - ✓ INFO - ✓ CasaLingua server shutdown completed successfully in 1.67s
╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ ✓ CasaLingua server shutdown completed successfully                                                                                                                          │
│ Time taken: 1.67s                                                                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
2025-05-08 16:31:46 - on - ✓ INFO - Application shutdown complete.
2025-05-08 16:31:46 - server - ✓ INFO - Finished server process [16875]
2025-05-08 16:31:46 - metrics - ✓ INFO - Metrics save task cancelled
2025-05-08 16:31:46 - metrics - ✓ INFO - Metrics save task cancelled
2025-05-08 16:31:46 - logger - ✓ INFO - Audit log cleanup task cancelled
2025-05-08 16:31:46 - logger - ✓ INFO - Audit log flush task cancelled
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
🔧 Starting CasaLingua in development mode
🚧 Dev mode active: DEBUG logging enabled, hot reload expected.
2025-05-08 16:31:51 - session_manager - ✓ INFO - Session manager initialized with 3600s TTL, 300s cleanup interval
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
WARNING:  WatchFiles detected changes in 'scripts/fix_tts_model.py'. Reloading...
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
WARNING:  WatchFiles detected changes in 'app/services/models/loader.py'. Reloading...
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
Process SpawnProcess-5:
Traceback (most recent call last):
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/server.py", line 68, in serve
    config.load()
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/config.py", line 467, in load
    self.loaded_app = import_from_string(self.app)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/importer.py", line 21, in import_from_string
    module = importlib.import_module(module_str)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/main.py", line 58, in <module>
    from app.services.models.loader import ModelLoader
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/__init__.py", line 15, in <module>
    from app.services.models.manager import EnhancedModelManager
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 26, in <module>
    from app.services.models.loader import ModelLoader
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1741
    def _load_pipeline_model(self, model_config: ModelConfig, device: str) -> Any:
SyntaxError: expected 'except' or 'finally' block
🔧 Starting CasaLingua in development mode
WARNING:  WatchFiles detected changes in 'app/audit/metrics.py'. Reloading...
/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
Process SpawnProcess-6:
Traceback (most recent call last):
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/server.py", line 68, in serve
    config.load()
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/config.py", line 467, in load
    self.loaded_app = import_from_string(self.app)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/site-packages/uvicorn/importer.py", line 21, in import_from_string
    module = importlib.import_module(module_str)
  File "/Users/jameswilson/.pyenv/versions/3.10.13/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/main.py", line 58, in <module>
    from app.services.models.loader import ModelLoader
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/__init__.py", line 15, in <module>
    from app.services.models.manager import EnhancedModelManager
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/manager.py", line 26, in <module>
    from app.services.models.loader import ModelLoader
  File "/Users/jameswilson/Desktop/PRODUCTION/test/casMay4/app/services/models/loader.py", line 1741
    def _load_pipeline_model(self, model_config: ModelConfig, device: str) -> Any:
SyntaxError: expected 'except' or 'finally' block
🔧 Starting CasaLingua in development mode
INFO:     Stopping reloader process [11522]
